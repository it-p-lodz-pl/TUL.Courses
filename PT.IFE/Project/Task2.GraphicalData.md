
# Task 2 â€“ Graphical Data Description

## Aims

The goal of the task is to learn how to create applications for Windows operating system with aid of `WPF` technology, `XAML` language and according to the `MVVM` software architectural pattern. After finishing the task student will be able to:

- Create applications for Windows operating system in `WPF` technology,
- Define the user interface with use of `XAML` language,
- Use the `MVVM` software architecture,
- Implement multi-layer applications.

## Description of the task

As a part of the task the student should create the computer program with multi-layer architecture designed to edit data using a graphical user interface (GUI). The task should be implemented using the data layer implemented previously in task 1.

The unit tests should be developed for each part of the project.

The following layers should be clearly identified (they are described in detail in the `Architecture` section):

- **Data layer**: access to the data repository
- **Services**: data processing services
- **Presentation**: graphical user interface (GUI)

## Architecture

### Data layer

As the process data repository the SQL database should be used and the types responsible for interaction with this database should be defined using LINQ to SQL. Where necessary, the functionality offered by these types should be extended.

### Services layer

- Classes responsible for processing of the data stored in the database must be implemented as a separate layer
- During the implementation of services it is necessary to provide functionality that allows to create, read, update and delete the entities (in short `CRUD`) from the database
- This layer should also provide the public API and hide the details of the implementation, e.g. the need to create a `DataContext`
- This layer must be implemented as a separate project

### Presentation layer

One should create a new `Visual C # > WPF Application`, i.e. an application for Windows using `WPF` technology that allows you to view and edit data. Create the main application window and define its basic behavior, such as initialization and shutdown. Design the appropriate GUI using `XAML` language. Use the created data service to manipulate data.

This layer must be implemented in accordance with the `Model-View-ViewModel` (`MVVM`) software pattern. This means that the following layers should be separated in it:

- View: a set of controls that directly provide interaction between a user and a program designed using `XAML` (`* .xaml`).
- `ViewModel`: classes responsible for the proper behavior of the user interface which should be designed to display current data and execute user commands depending on the state of the interface. The layer responsible for linking the controls to the API offered by the `Model` layer.
- `Model`: classes responsible for the storage of data required by the user interface (GUI) and needed for realization of data operations with use of the functionality offered by the layer described in the previous section Service layer.

The data and controls must be bind together using the data binding mechanism. It also means that you should not create a C# code in the view layer (so called code-behind) in `*.xaml.cs` files, except for the code automatically generated by the `Visual Studio`. In order to notify the `View` layer about changes in the lower layer, the implementation of `INotifyPropertyChanged` and `INotifyCollectionChanged` interfaces or their derivatives should be used.

In order to handle user commands the command mechanism (implementation of the `ICommand` interface) should be used. This applies in particular to the operation of buttons, but also to menus and other interface elements. The commands should be implemented as independent classes in the `ViewModel` layer.

The GUI should be designed in a way allowing to display a list of the main elements with the basic information. The detailed information should be presented for the selected element.

This means the need of implementation of the *Master-Detail* pattern. In the *Master* view, one should display data in the form of a table, without providing detailed information about the elements, which should be included only in the *Detail* view. The DataTemplate pattern elements should be used to display the data of individual elements.

The interface besides displaying the data must allow for its editing at any level. For example when editing employees/' data, the program should enable adding and removing employees, as well as editing the data of a specific employee. The program must allow for the storage of new or modified data in the database. In the user interface, it should be possible to perform data storage operations with a separate button or using the menu.

## Guidelines for implementation

The implementation of the task should take into account the recommendations defined by the programmers of Microsoft (Patterns & Practices), as well as good software development practices. More information on this subject can be found in the Supplementary materials section. In particular it should:

- Keep transparency of code implementation and segregation, e.g. by using the `Models`, `Views` and ViewModel folders.

*Database* operations, as potentially time-consuming, should not be executed in a way that would block a GUI which could cause a lack of interaction with the user. Hence, it is recommended to use asynchronous command execution, for example by using the `Task` class (i.e. *Task-based Asynchronous Pattern* for read and write operations in the database. The following example shows how this problem can be solved.

// Operation outside the user interface

```C#
void LongOperation() {
  // ...
}
```

``` C#
// Implementation of ICommand
void Execute() {
  // wrong
  LongOperation();

  // correct
  Task.Run(() => {
    LongOperation();
  });
}
```

There exist a lot of libraries that support the use of the MVVM pattern. Considering the use of one of them, please take into account that the main goal of the task is to understand what this mechanism is used for and how it works. This rule applies regardless of the proposed solution. It is clear that when implementing the chosen solutions by yourself it is guaranteed that the answer to the above questions is much easier.

It is often required during the implementation of GUI to show the user an additional window in order to signal an error or a situation that requires his/her decision. There are many ways to solve this problem. In this task, it is recommended to perform this type of operation in the `ViewModel` layer. Unfortunately, this makes it difficult to test this layer, because in a unit test a graphical control may appear, which is contradictory to the principle that tests must be carried out without interaction with the user. To solve this problem, simply use the dependency injection pattern and replace this functionality with another one that does not use graphical controls.

### Introduction

- [Windows Presentation Foundation](http://msdn.microsoft.com/library/ms754130.aspx)
- [WPF architecture](http://msdn.microsoft.com/library/ms750441.aspx)
- [XAML language](http://msdn.microsoft.com/library/ms747122.aspx)
- [WPF data binding](http://msdn.microsoft.com/library/ms752347.aspx)
- [Windows 10 MVVM In Depth](https://channel9.msdn.com/events/DEVintersection/DEVintersection-2016/DEV12)

### Realization of the task

- [MVVM TUTORIAL FROM START TO FINISH](http://www.software-architects.com/devblog/2010/09/10/MVVM-Tutorial-from-Start-to-Finish)
- [WPF Master Details MVVM Application](http://www.codeproject.com/Articles/332615/WPF-Master-Details-MVVM-Application)
- [Opis relacji bazy danych Adventure Works](https://akela.mendelu.cz/~jprich/vyuka/db2/AdventureWorks2008_db_diagram.pdf)

### Additional resources

- [Optimizing WPF Application Performance](http://msdn.microsoft.com/library/aa970683.aspx)
- [Implementing the MVVM Pattern Using the Prism Library 5.0 for WPF](http://msdn.microsoft.com/library/gg405484.aspx)
- [MVVM Best Practices](https://channel9.msdn.com/Shows/Visual-Studio-Toolbox/MVVM-Best-Practices)
- [A Practical Quick-start Tutorial on MVVM in WPF](http://www.codeproject.com/Articles/81484/A-Practical-Quick-start-Tutorial-on-MVVM-in-WPF)
- [Asynchronous programming patterns](https://msdn.microsoft.com/library/jj152938.aspx)
- [Task-based Asynchronous Pattern (TAP)](https://msdn.microsoft.com/library/hh873175.aspx)
